<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zpw.po.Vitae">
	<insert id="insertVitae" parameterType="Vitae">
		insert into tb_vitae
		(username,name,sex,city,age,edu,school,major,grad_year,phone,email,job,job_city,money,interest,skill,experience,personal)
		values(#{username},#{name},#{sex},#{city},#{age},#{edu},#{school},#{major},#{grad_year},#{phone},#{email},#{job},#{job_city},#{money},#{interest},#{skill},#{experience},#{personal})
	</insert>

	<select id="qByUsername" resultType="Vitae">
		select * from tb_vitae where
		username=#{username}
	</select>

	<update id="updateVitae" parameterType="Vitae">
		update tb_vitae
		set(name,sex,city,age,edu,school,major,grad_year,phone,email,job,job_city,money,interest,skill,experience,personal)
		values(#{name},#{sex},#{city},#{age},#{edu},#{school},#{major},#{grad_year},#{phone},#{email},#{job},#{job_city},#{money},#{interest},#{skill},#{experience},#{personal})
		where username=#{username}
	</update>

	<select id="qByUsernameList" resultType="Vitae_Job">
		select * from
		tb_vitae,tb_vitae_job
		where tb_vitae_job.ep_username=#{username}
		and
		tb_vitae_job.username = tb_vitae.username
	</select>

	<select id="qByKwList" resultType="Vitae">
		SELECT TOP ${num} *
		FROM
		(
		SELECT
		ROW_NUMBER() OVER (ORDER BY id) AS RowNumber,* FROM tb_vitae 
		<where>  
            <if test="kw != null">  
                and job like '%${kw}%'
            </if> 
            <if test="city != null">  
                and tb_vitae.city = #{city}
            </if>
            <if test="edu != null">  
                tb_vitae.edu = #{edu}
            </if>
        </where>
		) as A
		WHERE RowNumber > ${num}*(${page}-1)
	</select>
	
	<select id="qAllCount" resultType="Integer">
		select count(*) from tb_vitae
	</select>
	
</mapper>